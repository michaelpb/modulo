<!-- Load some global JS deps -->
<Script -src="/js/codemirror_5.63.0/codemirror_bundled.js">
    modulo.register('util', CodeMirror); // Expose CodeMirror as a global utility

    // Expose a global utility, which creates an object containing the contents
    // of components specified by the path (sans TestSuites and <Component> def
    // itself). Used by <mws-Demo> code snippets in site.
    function getComponentDefs(path) {
        if (!(path in modulo.fetchQueue.data)) {
            console.error('ERROR: Have not loaded:', path);
            return {};
        }
        const sourceText = modulo.fetchQueue.data[path];
        const componentTexts = {};
        let name = '';
        let currentComponent = '';
        let inTestSuite = false;
        for (const line of sourceText.split('\n')) { // Crude line-by-line parser
            //const lower = line.trim().toLowerCase(); // TODO: Possibly tolerate whitespace?
            const lower = line.toLowerCase();
            if (lower.startsWith('</component>')) {
                componentTexts[name] = currentComponent;
                currentComponent = '';
                name = null;
            } else if (lower.startsWith('<component')) {
                name = line.split(' name="')[1].split('"')[0];
            } else if (lower.startsWith('<testsuite')) {
                inTestSuite = true;
            } else if (lower.includes('</testsuite>')) {
                inTestSuite = false;
            } else if (name && !inTestSuite) {
                currentComponent += line + '\n';
            }
        }
        return componentTexts;
    }
    modulo.register('util', getComponentDefs);
</Script>

<!-- Components referenced in below examples (registering with "x" for easy
global use) -->
<!-- TODO - This seems to always break in a way that prevents other libraries
from loading if listed last (which shouldn't matter), should check again -->
<Library -name="x" -src="/libraries/globalExamples.html"></Library>

<!-- Load the MWS library, with elements for the Modulo website -->
<Library -name="mws" -src="/libraries/mws.html"></Library>

<!-- Examples used as embedded code snippets in docs -->
<Library -name="docseg" -src="/libraries/docseg.html"></Library>

<!-- Examples used for the demo library -->
<Library -name="eg" -src="/libraries/eg.html"></Library>

