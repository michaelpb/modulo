<!-- Embedding here for now. Need to refactor to avoid having to do this: -->
<link rel="stylesheet" href="/js/codemirror_5.63.0/codemirror_bundled.css" />
<script src="/js/codemirror_5.63.0/codemirror_bundled.js"></script>
<!-- ... -->
<script src="/js/Modulo.js"></script>
<modulo>
    <load namespace="x" src="/components/layouts.html"> </load>
</modulo>

<script>
        window.onload = () => Modulo.defineAll()
</script>

<template modulo-embed>
    <Component name="AllExamples">
        <Template>
            {% for example in script.exports.examples %}
                <mws-Section name="{{ example.name|lower }}">
                    {{ example.name }}
                </mws-Section>
                <mws-Demo
                    demotype="minipreview"
                    fromlibrary='{{ example.name }}'
                ></mws-Demo>
            {% endfor %}
        </Template>

        <Script>
            console.log('loading AllExamples');
            script.exports.examples = [];
            function initializedCallback() {
                // TODO: make initialized only get called once
                // TODO: Encapsolate this into a dependency pattern, if proves
                // useful
                Modulo.fetchQ.enqueue('/components/examplelib.html', (text) => {
                    Modulo.fetchQ.wait(() => _setup(text));
                });
            }
            function _setup(text) {
                let componentTexts;
                try {
                    componentTexts = Modulo.factoryInstances['eg-eg']
                    componentTexts = Modulo.factoryInstances['eg-eg']
                            .baseRenderObj.script.exports.componentTexts;
                } catch {
                    console.log('couldnt get componentTexts (2)', Modulo.factoryInstances);
                    componentTexts = null;
                }
                if (!componentTexts) {
                    return;
                }

                script.exports.examples = [];
                for (const [name, content] of Object.entries(componentTexts)) {
                    //console.log("dis is conent", content);
                    script.exports.examples.push({name, content});
                }
                element.rerender();
            }
        </Script>
    </Component>
</template>


<!--
<script src="/js/Modulo.js"></script>
<script>Modulo.defineAll()</script>
<mod-load namespace="x" src="/components/layouts.html"></mod-load>

Just for testing purposes:
<script src="/m.js"></script>
-->

<x-Page
    docbarselected="example-library.html"
    pagetitle="Example Library"
    navbar="docs">


<h1>Example Library</h1>

<x-AllExamples></x-AllExamples>

</x-Page>

