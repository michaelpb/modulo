<!--
    This demo shows how you can create simple unit tests using Modulo's
    TestSuite CPart. Modulo's TestSuite CPart isn't intended to replace full
    testing frameworks, but instead is intended for allowing quick development
    of unit-testing of components in particular.
-->
<template modulo-embed>
    <Component name="ExampleClickingComponent">
        <Props
            txt
        ></Props>
        <Template>
            <div>
                <h1>Props: {{ props.txt }}</h1>
                <button @click:=script.getClicked>State: {{ state.count }}</button>
            </div>
        </Template>

        <State
            count:=5
        ></State>

        <Script>
            function getClicked() {
                console.log('Note how TestSuites "group" console messages');
                state.count++;
            }
        </Script>


        <TestSuite>
            <Test name="Check props and click event">
                <props txt="Testing 123"></props>

                <template>
                    <div>
                        <h1>Props: Testing 123</h1>
                        <button @click:=script.getClicked>State: 5</button>
                    </div>
                </template>

                <!-- We can use "script" for simulating user actions: -->
                <script>
                    event: click button
                </script>

                <!-- Finally, using another Template assertion, we make sure
                that the component rerendered in the expected way, as a result
                of the simulated click: -->
                <template>
                    <div>
                        <h1>Props: Testing 123</h1>
                        <button @click:=script.getClicked>State: 6</button>
                    </div>
                </template>
            </Test>

            <Test name="Check state reflects in rendering">
                <!-- Another test, with a few more example steps -->
                <props txt="Example props"></props>

                <!-- Can force state to be a certain thing for testing: -->
                <state count:=1></state>

                <!-- Can check for exact (un-normalized) string occurrences
                within the browser's innerHTML. Specify a string-count with any
                count (including 0 to "ban" a string from occurring) -->
                <template string-count=1>Example props</template>
                <template string-count=1>State: 1</template>
                <template string-count=0>State: 6</template>

                <!-- Can write arbitrary assertions and code in script tag: -->
                <script name="Check state and prop CParts">
                    assert: props.txt === 'Example props' && state.count === 1
                </script>

            </Test>
        </TestSuite>
    </Component>

</template>

<!-- Finally, include a Modulo CDN link & activate (at the bottom) -->
<script src="/js/Modulo.js"></script>
<script src="/demos/mdu/cparts/TestSuite.js"></script>
<script src="/demos/mdu/extensions/virtualdom.js"></script>

<script>
    setTimeout(() => {
        const vm = new Modulo.virtualdom.ModuloVM();
        vm.loadBundle(() => {
            // Once defined, we can run the test command within the virtual machine / virtualdom
            vm.Modulo.fetchQ.wait(() => {
                console.log('loaded!', vm.document.innerHTML);
                console.log('loaded!', vm.window);
                vm.Modulo.cmd.test();
            });
        });
    }, 0);
</script>


